

<?php $__env->startSection('content'); ?>

            <?php 
            $amount=0;
           // Session::forget("saleItems");
           // echo'<pre>';print_r(Session::get('saleItems'));
            if(Session::get('saleItems')){
                foreach(Session::get('saleItems') as $item)
                                 $amount=$amount+$item['total'];
            }
            $invoicesInQueue=count(Session::get('saleInvoiceQueue'));
             ?>
        <?php if(Session::get('saleInvoiceQueue')): ?>
        <div id="sticky">
        <ul id="example-1" class="sticklr stick-que" style="margin-left: 40px;">
            <li>
                <a href="javascript:;" title="Sales Queue"><?php echo HTML::image('img/nav_icon/purchase.png', 'title', array('class' => 'sticky_icon')); ?> <span class="notification-count"><?php echo $invoicesInQueue; ?></span></a>
                <ul>
                    <li class="sticklr-title">
                        <a href="#">Queue List</a>
                    </li>
                    <?php foreach(Session::get('saleInvoiceQueue') as $customer=>$invoice): ?>
                    <li>
                        <?php echo Form::open(array('route' => 'sale.reloadDeleteInvoiceQueueElement', 'id' => 'formReloadDeleteInvoiceQueueElement', 'class' => 'form-horizontal')); ?>

                            <?php echo $customer; ?>

                            <input type="hidden" name="customer" value="<?php echo $customer; ?>">
                           <span id="btn-queue">
                            <button type="submit" class="btn btn-info btn-small" name="reloadDelete"  onclick="isSureToReloadInvoiceFromQueue();"><i class="setup-icon icon-undo"></i></button>
                            <button type="submit"  class="btn btn-warning btn-small" name="reloadDelete" value="delete"  onclick="return isSureToDeleteInvoiceFromQueue();"><i class="icon-remove"></i></button>
                                                    
                           </span>
                        <?php echo Form::close(); ?>

                    </li>
                    <?php endforeach; ?>
                </ul>
            </li>             
        </ul>  
        </div>
        <?php endif; ?>
    <div class="row">
        <div class="span8">
                    <?php echo $__env->make('_sessionMessage', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                    <div style="height:24px;" class='label label-info'>
                    <h4><i class='icon-shopping-cart'></i> Sales Register 
                    <?php if(Session::get('saleItems')): ?>
                        <a style="float:right;"  id="addInvoiceToQueue" role="button" data-toggle="modal" onclick="addInvoiceToQueue();" class="btn btn-success btn-small">Hold this invoice</a>
                        <span id='topTotalQuantity' class='label label-warning' style='font-size:22px; border-radius:90px;'></span>
                        <a style="float:right;"  class="btn btn-warning btn-small" href="<?php echo route('sale.emptyCart'); ?>">Clear Screen</a>
                    <?php endif; ?>
                    </h4> 
                    </div>
            <div class="invoice-reg"><input type="hidden" id="max_dis_percent" value="<?php echo Session::get('max_inv_dis_percent');; ?>">
                                <!-- <?php echo Session::get('max_inv_dis_percent');; ?>!-->
                <?php echo Form::open(array('route' => 'sale.addItemToChart', 'id' => 'formItemLocation', 'class' => 'form-horizontal')); ?>

                    <div class="control-group">
                        <?php echo Form::label('search_item', 'Find/Scan Item', ['class' => 'control-label', 'style' => 'font-weight: bold;']); ?>

                        <div class="controls">
                            <?php echo Form::text('item_id', null, array('class' => 'span6','autofocus'=>'yes','id'=>'auto_search_item', 'placeholder' => 'Start Typing item\'s name or scan barcode...')); ?>

                        </div> <!-- /controls -->
                    </div> <!-- /control-group -->
                <?php echo Form::close(); ?>

            </div>

            <table class="table table-bordered" width="100%">
                <thead class="table-head">
                    <tr>
                        <th>SL</th>
                        <th>Item Name</th>
                        <th>Sale Price</th>
                        <th>Available Qty.</th>
                        <th>Sale Qty.</th>      
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <?php 
                        $i=0; $invoice_total=0; 
                        if(Session::get('saleItems')){
                            $reverse_items= array_reverse(Session::get('saleItems'));
                        }
                        $totalQuantity = 0;
                        $totalPoint = 0;
                    ?>
                    <?php if(Session::get('saleItems')): ?>
                        
                        <?php foreach($reverse_items as $item): ?>
                            <? $invoice_total=$invoice_total+$item['total'];
                            $totalQuantity+=$item['sale_quantity'];
                            $totalPoint = $totalPoint + ($item['item_point'] * $item['sale_quantity']);
                            ?>
                            <?php echo Form::open(array('route' => 'sale.editDeleteItem', 'class' => 'form-horizontal')); ?>

                                <tr>                            
                                    <td><?php echo ++$i; ?></td>
                                    <td style="width: 330px;">
                                        <span class="span3" style="font-weight: bolder; font-size: 14px;">
                                            <?php echo $item['item_name']; ?>

                                            <input type="hidden" name="key" value="<?php echo $item['key']; ?>">
                                            <input type="hidden" name="item_id" value="<?php echo $item['item_id']; ?>">
                                            <input type="hidden" name="item_point" value="<?php echo $item['item_point']; ?>">
                                            <input type="hidden" name="price_id" value="<?php echo $item['price_id']; ?>">
                                            <input type="hidden" name="item_name" value="<?php echo $item['item_name']; ?>">
                                        </span>
                                    </td>
                                    <td>
                                        <input class="span1" type="text" readonly name="sale_price" value="<?php echo $item['sale_price']; ?>" />
                                    </td>
                                    <td>
                                    <?php if($item['sale_quantity']==0): ?>
                                            <input class="span1 available_quantity" style="background-color:red; color:#fff;"  type="text" readonly name="available_quantity" value="<?php echo $item['available_quantity']; ?>" />
                                        <?php else: ?>
                                            <input class="span1 available_quantity"  type="text" readonly name="available_quantity" value="<?php echo $item['available_quantity']; ?>" />
                                    <?php endif; ?>
                                    </td>
                                    <td>
                                        <input class="span1 saleQuanty" type="text" name="sale_quantity"  autocomplete="off" value="<?php echo $item['sale_quantity']; ?>" />
                                        <input class="span1 floatingCheck" type="hidden" name="discount" autocomplete="off" value="<?php echo $item['discount']; ?>" readonly=""/>
                                    </td>
                                    
                                    <td>
                                        <input type="text" name="total"  class="span1 disabled" disabled="" value="<?php echo $item['total']; ?>" />
                                    </td>
                                    <td class="span2">
                                        <button type="submit" class="edit btn btn-primary" name="edit_delete" value="edit"><i class="icon-edit"></i></button>
                                        <button type="submit" class="btn btn-warning" name="edit_delete"><i class="icon-trash"></i></button>
                                    </td>
                                </tr>
                            <?php echo Form::close(); ?>

                        <?php endforeach; ?>
                        <?php else: ?>
                            <tr>
                                <td colspan="8" style="text-align:center; color:#E98203;"><strong>There are no items in the cart</strong><td>
                            </tr>
                    <?php endif; ?>
                    <?php if(Session::get('saleItems')): ?>
                            <tr>
                                <td colspan="8" style="text-align:center; color:#E98203;">
                                <strong>Total Item : <?php echo $totalQuantity; ?></strong>
                                <input type='hidden' id='toalQuantity' value='<?php echo $totalQuantity; ?>'>
                                <td>
                            </tr>
                    <?php endif; ?>
                </tbody>
            </table>
        </div>
        <div class="span4">
            <div class="invoice-right">
                <?php echo Form::open(array('route' => 'sale.selectDeleteCustomer','autocomplete'=>'off', 'id' => 'customerForm')); ?>

                    <?php if(Session::get('sale_invoice_info.user_name')): ?>                                        
                        <div class="control-group hr">
                            <label class="control-label" for="supplier_name"><strong style="font-size: 1.1em;"><u>Customer</u></strong></label>
                            <div class="controls">
                                <table class="table table-striped" style="margin: 0; padding:0;">
                                    <tbody> 
                                        <tr>
                                            <td>Customer Name</td>
                                            <td>:</td>
                                            <td><strong id="customer_name" style="color: green; font-size: 1.4em;">
                                                <?php echo Session::get('sale_invoice_info.user_name'); ?>

                                                <input type="hidden" id="customer" value="<?php echo Session::get('sale_invoice_info.user_name'); ?>">
                                                <input type="hidden" id="cust_type_discount_percent" value="<?php echo Session::get('sale_invoice_info.discount_percent'); ?>">
                                            </strong>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <button type="submit" style="margin: 7px 0 7px" class="btn btn-warning" name="customer" value="delete"><i class="icon-trash"></i> &nbsp;Remove</button>
                            </div> <!-- /controls -->
                        </div>
                    <?php else: ?>
                        <div class="control-group hr">
                            <label class="control-label" for="supplier"><b>Select Customer (Optional)</b></label>
                            <div class="controls">
                                <?php echo Form::text('national_id', null, array('class' => 'span3', 'id' => 'customerAutoSugg', 'placeholder' => 'Start Typing Customer\'s name...')); ?>

                                <input type="hidden" id="customer" value="">
                            </div> <!-- /controls -->
                        </div>
                    <?php endif; ?>
                <?php echo Form::close(); ?>

                <div>
                    <?php echo Form::open(array('route' => 'sale.invoiceAndSale','autocomplete'=>'off', 'class' => 'form-horizontal')); ?>

                    <table class="table table-striped" style="margin: 0; padding:0;">
                        <tbody>
                        <?php if(Session::get('backdate_sales')==0): ?>
                        <input name="date" type="hidden" value="<?= date("Y-m-d") ?>">
                        <?php else: ?>
                            <tr>
                                <td>Date </td>
                                <td>:</td>
                                <td style="padding:0;">
                                    <input id="dp3" name="date" data-date="<?= date("Y-m-d") ?>" data-date-format="yyyy-mm-dd" class="datepicker span2" type="text" value="<?= date("Y-m-d") ?>">
                                </td>
                            </tr>
                            <?php endif; ?>
                            <tr>
                                <td>Payment Type</td>
                                <td>:</td>
                                <td style="padding:0;">
                                    <?php echo Form::select('payment_type_id', $payment_type, 1, ['class' => 'span3', 'style' => 'margin-top: 3px;']); ?>

                                </td>
                            </tr>
                            <tr>
                                <td>Sub Total Amount</td>
                                <td>:</td>
                                <td><strong id="total_amount" style="color: green; font-size: 1.4em;"><?php echo $invoice_total; ?></strong></td>
                            </tr>
                            <tr>
                                <td>Discount</td>
                                <td>:</td>
                                <td style="padding:0;">

                                  
                                    <input style="margin-top: 3px; width:65px;" type="text" maxlength="5" readonly id="dis_percent" name="discount_percent" data-toggle="tooltip" title="Discount (%)" value="<?php if(Session::get('sale_invoice_info.user_name')): ?><?php echo Session::get('sale_invoice_info.discount_percent'); ?>%<?php endif; ?>"  placeholder="Discount(%)">&nbsp;&nbsp;
                                    <input type="text" maxlength="10" id="dis_taka" name="invoice_discount"  data-toggle="tooltip" title="Discount (Tk.)" placeholder="Discount(Taka)" <?php if(Session::get('sale_invoice_info.user_name')): ?> readonly="" value="<?php echo ($invoice_total-Session::get('invoice_info.invoice_discount'))*(Session::get('sale_invoice_info.discount_percent')/100); ?>" <?php endif; ?>  <?php if(Session::get('sale_invoice_info.discount_permission') == 0): ?> readonly="" style="width:85px !important;" <?php endif; ?> style="margin-top: 3px; width:120px;">

                                    <?php if(Session::get('sale_invoice_info.discount_permission') == 0): ?>
                                        <a id="discountPermission" class="btn btn-xs btn-success" role="button" data-toggle="modal" onclick="discountPermissionCheck();"> 
                                            <i class="icon-check"></i> 
                                        </a>
                                    <?php endif; ?>
                                </td>

                            </tr>
                            <tr>
                                <td>Total Point</td>
                                <td>:</td>
                                <td><strong id="" style="color: green; font-size: 1.8em; font-family:Times;"><?php echo $totalPoint; ?></strong></td>
                            </tr>
                            <tr>
                                <td>Total Amount (Tk)</td>
                                <td>:</td>
                                <td><strong id="pay_amount" style="color: red; font-size: 2.4em; font-family:Times;">
                                <?php if(Session::get('sale_invoice_info.user_name')): ?>
                                <?php
                                    $amountTaka = $invoice_total-Session::get('invoice_info.invoice_discount');
                                    $amountTaka = $amountTaka - ($amountTaka*(Session::get('sale_invoice_info.discount_percent')/100));
                                    echo $amountTaka;
                                ?>
                                <?php else: ?>
                                <?php echo $invoice_total-Session::get('invoice_info.invoice_discount'); ?>

                                <?php endif; ?>
                                </strong></td>
                            </tr>
                            <tr>
                                <td>Pay</td>
                                <td>:</td>
                                <td style="padding:0;">
                                    <div class="input-prepend input-append">
                                        <input class="span2" type="text" readonly id="appendedPrependedInput" maxlength="10" class="span2" name="pay" value="<?php if(Session::get('sale_invoice_info.user_name')): ?><?php echo $amountTaka; ?><?php else: ?><?php echo $amount; ?><?php endif; ?>">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Pay Note</td>
                                <td>:</td>
                                <td style="padding:0;">
                                    <input type="text" class="span2" id="paynote" autocomplete="off" maxlength="10" name="paynote" value="">
                                    <input type='hidden' id='totalPoint' name="totalPoint" value='<?php echo $totalPoint; ?>'>

                                </td>
                            </tr>
                            <tr>
                                <td>Return Taka</td>
                                <td>:</td>
                                <td><strong id="return_taka" style="color: green; font-size: 1.4em;">0.00</strong></td>
                            </tr>
                             
                        </tbody>
                    </table>
                    <div style="text-align: left; margin-left: 10px;">
                        <button type="submit" class="btn btn-danger" onclick="return isUnRegisteredCustomer();">Complete Sale</button>
                    </div>
                    <?php echo Form::close(); ?>

                </div>

            </div>
        </div>
    </div>
    <?php echo HTML::script('js/jquery-ui.min.js'); ?>

    <script>
        $().ready(function(){
             //Auto Complete for Item Search
             $("#auto_search_item").autocomplete("<?php echo route('sale.itemAutoSuggest'); ?>", {
                width: 260,
                matchContains: true,
                queryDelay : 0,
                formatItem: function(row) {
                    return row[1];
                },
            });
            //Submit Search Item Form
            $("#auto_search_item").result(function(event, data, formatted) {
                $("#formItemLocation").submit();
            });

            //Customer auto suggest
            $("#customerAutoSugg").autocomplete("<?php echo route('sale.autoCustomerSuggest'); ?>", {
                width: 260,
                matchContains: true,
                queryDelay : 0,
                formatItem: function(row) {
                    return row[1];
                }
            });
            //Submit Supplier Form
            $("#customerAutoSugg").result(function(event, data, formatted) {
                $("#customerForm").submit();
            });
        
            //Discount Calculate for percent
            var totalAmount = parseFloat($("#total_amount").html());
            if(totalAmount>=1000){
                autoDiscountCalculation(totalAmount);
            }

            function autoDiscountCalculation(totalAmount){
                var discountPercent= parseFloat($("#cust_type_discount_percent").val());
                 if(discountPercent>0){
                     var discountAmount= ((totalAmount*discountPercent)/100).toFixed(0);
                     $("#dis_percent").val(discountPercent+" %");
                     $("#dis_taka").val(discountAmount);
                     $("#pay_amount").html(totalAmount-discountAmount);
                     $("#appendedPrependedInput").val(totalAmount-discountAmount);
                 }
            }

            $('#dis_percent').keyup(function(){
                var $total_amount = $('#total_amount').html();
                var $point_taka = parseFloat($('#point_taka').html());
                if(isNaN($point_taka)){
                    $point_taka = 0;
                }
                var max_dis_percent = parseFloat(document.getElementById("max_dis_percent").value);
                var discount_percent=parseFloat(this.value);
                if(isNaN(discount_percent)){
                    discount_percent = 0;
                }
                var discount_taka=0;
                var $sub_total_amount=($total_amount-$point_taka).toFixed(2);
                var $sub_total_percent=(($sub_total_amount*100)/$total_amount);
                
                var intRegex = /^\d+$/;
                var floatRegex = /^((\d+\.(\.\d *)?)|((\d*\.)?\d+))$/;
                var str = $(this).val();

                if(this.value==''){
                   this.value=null;
                    $('#dis_taka').val(0);
                    $('#pay_amount').html(($total_amount-$point_taka).toFixed(2));
                    $('#appendedPrependedInput').val(($total_amount-$point_taka).toFixed(2));
                }
                else if(intRegex.test(str) || floatRegex.test(str)) {
                    $('#dis_taka').attr('readonly','readonly');
                    var new_discount_percent1=0;
                    var new_discount_percent2=0;
                    var confirm_discount_percent=0;
                    if(discount_percent>max_dis_percent){
                        if(max_dis_percent>$sub_total_percent){
                            new_discount_percent1=$sub_total_percent;
                        }
                        else{
                            new_discount_percent1=max_dis_percent;
                        }
                    }
                    if(discount_percent>$sub_total_percent){
                        new_discount_percent2=$sub_total_percent;
                    }

                    new_discount_percent1=parseFloat(new_discount_percent1);
                    new_discount_percent2=parseFloat(new_discount_percent2);

                    if((new_discount_percent1==0) && (new_discount_percent2==0)){
                       // alert("no break one");
                        this.value=this.value;
                        confirm_discount_percent=parseFloat(this.value);
                    }
                    else if((new_discount_percent1==0)&&(new_discount_percent2>0)){
                       // alert("first break one");
                       // alert(new_discount_taka2);
                        this.value=new_discount_percent2.toFixed(2);
                        confirm_discount_percent=parseFloat(new_discount_percent2);
                    }
                    else if((new_discount_percent1!=0)&&(new_discount_percent2==0)){
                        //alert("2nd break one");
                        this.value=new_discount_percent1.toFixed(2);
                        confirm_discount_percent=parseFloat(new_discount_percent1);
                    }
                    else{

                        if(new_discount_percent1<new_discount_percent2){
                            this.value=new_discount_percent1.toFixed(2);
                            confirm_discount_percent=parseFloat(new_discount_percent1);
                        }
                        else{
                            this.value=new_discount_percent2.toFixed(2);
                            confirm_discount_percent=parseFloat(new_discount_percent2);
                        }
                    }
                    discount_taka=(($total_amount/100)*confirm_discount_percent);
                    
                    $('#dis_taka').val(discount_taka.toFixed(2));
                    $('#pay_amount').html(($total_amount-(discount_taka+$point_taka)).toFixed(2));
                    $('#appendedPrependedInput').val(($total_amount-(discount_taka+$point_taka)).toFixed(2));
                }
                else{
                    alert('Wrong Data');
                    this.value = '';
                    $('#dis_taka').val(0.00);
                    $('#pay_amount').html(($total_amount-$point_taka).toFixed(2));
                    $('#appendedPrependedInput').val(($total_amount-$point_taka).toFixed(2));
                    $('#due').html(0.00);
                    return false;
                }
            });

            //Discount Calculate for Taka
            $('#dis_taka').keyup(function(){                
                var $total_amount = $('#total_amount').html();
                var $point_taka = parseFloat($('#point_taka').html());
                if(isNaN($point_taka)){
                    $point_taka = 0;
                }
                var max_dis_percent = parseFloat(document.getElementById("max_dis_percent").value);
                var max_dis_taka=(($total_amount/100)*max_dis_percent);                              
                var $sub_total_amount=($total_amount-$point_taka).toFixed(2);
                var discount_taka=parseFloat(this.value);
                if(isNaN(discount_taka)){
                    discount_taka = 0;
                }   
                var intRegex = /^\d+$/;
                var floatRegex = /^((\d+\.(\.\d *)?)|((\d*\.)?\d+))$/;
                var str = $(this).val();                               
                                
                if(this.value==''){
                   this.value=null;
                    $('#dis_percent').val(0);
                    $('#pay_amount').html(($total_amount-$point_taka).toFixed(2));
                    $('#appendedPrependedInput').val(($total_amount-$point_taka).toFixed(2));
                }
                else if(intRegex.test(str) || floatRegex.test(str)) {                                    
                    $('#dis_percent').attr('readonly','readonly');
                    var new_discount_taka1=0;
                    var new_discount_taka2=0;
                    var confirm_discount=0;
                    if(discount_taka>max_dis_taka){
                        if(max_dis_taka>$sub_total_amount){
                            new_discount_taka1=$sub_total_amount;
                        }
                        else{
                            new_discount_taka1=max_dis_taka;
                        }
                    }
                    if(discount_taka>$sub_total_amount){
                        new_discount_taka2=$sub_total_amount;
                    }

                    new_discount_taka1=parseFloat(new_discount_taka1);
                    new_discount_taka2=parseFloat(new_discount_taka2);

                    if((new_discount_taka1==0) && (new_discount_taka2==0)){
                        this.value=this.value;
                        confirm_discount=parseFloat(this.value);
                    }
                    else if((new_discount_taka1==0)&&(new_discount_taka2>0)){
                       
                        this.value=new_discount_taka2.toFixed(2);
                        confirm_discount=parseFloat(new_discount_taka2);

                    }
                    else if((new_discount_taka1!=0)&&(new_discount_taka2==0)){
                        //alert("2nd break one");
                        this.value=new_discount_taka1.toFixed(2);
                        confirm_discount=parseFloat(new_discount_taka1);
                        
                    }
                    else{
                       
                        if(new_discount_taka1<new_discount_taka2){
                            
                            this.value=new_discount_taka1.toFixed(2);
                            confirm_discount=parseFloat(new_discount_taka1);
                        }
                        else{
                            this.value=new_discount_taka2.toFixed(2);
                            confirm_discount=parseFloat(new_discount_taka2);
                        }
                    }
                    $('#dis_percent').val((((confirm_discount*100)/$total_amount).toFixed(2))+' %');
                    $('#pay_amount').html(($total_amount-(confirm_discount+$point_taka)).toFixed(2));
                    $('#appendedPrependedInput').val(($total_amount-(confirm_discount+$point_taka)).toFixed(2));
                }                                
                else{
                    alert('Wrong Data');
                    this.value = '';
                    $('#dis_percent').val(0.00);
                    $('#pay_amount').html(($total_amount-$point_taka).toFixed(2));
                    $('#appendedPrependedInput').val(($total_amount-$point_taka).toFixed(2));
                    $('#due').html(0.00);
                    return false;
                }
            });


            $('#appendedPrependedInput').keyup(function(){
                //var discount_taka = parseFloat(this.value);
                var regex =  /^\d*(?:\.{1}\d+)?$/;
                var pay =parseFloat(this.value);
                var $payable = parseFloat($('#pay_amount').html());
                //alert(pay>$payable)
                var pay_note =parseFloat(document.getElementById("paynote").value);
                var return_taka=0;
                
                if(this.value==''){
                    this.value=null;
                    $('#due').html($payable.toFixed(2));
                    $('#return_taka').html(0.00);
                }
                else{
                    if (this.value.match(regex)) {  
                        if(pay>$payable){
                            this.value=$payable;
                            $('#due').html(0.00);
                            $('#return_taka').html((isNaN(pay_note-$payable)) ?0:(pay_note-$payable).toFixed(2));
                        }
                        else{
                        $('#due').html(($payable-pay).toFixed(2));
                        $('#return_taka').html((isNaN(pay_note-pay)) ?0:(pay_note-pay).toFixed(2));
                        }                                   
                    }                                  
                    else{   
                        this.value='';
                        $('#due').html($payable.toFixed(2));
                        $('#return_taka').html(0.00);
                    }
                }
            });
                        
            $('#paynote').keyup(function(){
                var regex =  /^\d*(?:\.{1}\d+)?$/;
                var pay_taka = parseFloat(document.getElementById("appendedPrependedInput").value);
                var pay_note =parseFloat(this.value);
                var return_taka=0;
                if(this.value==''){
                    this.value=null;
                    $('#return_taka').html(0.00);
                }
                else{
                    if (this.value.match(regex)) {                                        
                        $('#return_taka').html((pay_note-pay_taka).toFixed(2));
                    } else {   
                        this.value='';
                        $('#return_taka').html(0.00);
                    }
                }
            });


            $('.floatingCheck').keyup(function(){
                var intRegex = /^\d+$/;
                var floatRegex = /^((\d+\.(\.\d *)?)|((\d*\.)?\d+))$/;
                var str = $(this).val();
                if(this.value==''){
                   this.value='';
                }
                else if(intRegex.test(str) || floatRegex.test(str)) {
                   
                }
                else{
                    alert('Wrong Data');
                    this.value ='';
                }
            });

          $('.saleQuanty').blur(function(){
                var intRegex = /^\d+$/;
                var floatRegex = /^((\d+\.(\.\d *)?)|((\d*\.)?\d+))$/;
                var str = $(this).val();
                if(this.value==''){
                   this.value=1;
                }
                else if(this.value=='0') {
                    this.value=1;
                }
                else if(intRegex.test(str) || floatRegex.test(str)) {

                }
                else{
                    alert('Wrong Data');
                    this.value = 1;
                }

            });

            //for input box tooltip
            $('input[type=text][name=discount_percent]').tooltip({
                placement: "right",
                trigger: "hover"
            });

        });


        function saleQuantyCheck() {
            saleQuanty.value = 22;
        }

        
        function isUnRegisteredCustomer() {

        var customer = document.getElementById("customer").value;
        var $total_amount = parseFloat($('#total_amount').html());
        if($total_amount==0){
           alert("Error! There is no selected item for sale.");
           return false;
        }
        
        if(!customer){
            //payabe cash check//
        if(parseFloat($("#paynote").val()) < parseFloat($("#appendedPrependedInput").val())){
            alert("Sorry you can'\t pay less than amount");
            return false;
        }
            var $due = $('#due').html();
            if($due>0){
                alert("Error! Unregistered Customer Can not allow for due.");
                return false;
            }
            var confirmation=confirm("Are you sure to complete the sale?");
            if(confirmation){
                return true;
            }
            return false;
        }
        else{
            if(parseFloat($("#paynote").val()) < parseFloat($("#appendedPrependedInput").val())){
                alert("Sorry you can'\t pay less than amount");
                return false;
            }
            var confirmation=confirm("Are you sure to complete the sale?");
            if(confirmation){
                return true;
            }
            return false;
        }


    }

        function addInvoiceToQueue() {
            var customer = document.getElementById("customer").value;
            var x = document.getElementById("addInvoiceToQueue");
            
            if(customer){
                window.location="<?php echo URL::to('sale/addInvoiceToQueue'); ?>";
            }
            else{   
            x.setAttribute("href", "#addInvoiceToQueueModal");
            }

        }

        function discountPermissionCheck() {
            var x = document.getElementById("discountPermission");
            x.setAttribute("href", "#discountPermissionModal");
        }
         function isSureToDeleteInvoiceFromQueue() { 
            var confirmation=confirm("Are you sure to delete the invoice from queue ?");
            if(confirmation){
               return true;
            }
            else{
                return false;
            }  
        }
         function isSureToReloadInvoiceFromQueue() { 
            var confirmation=confirm("Are you sure to reload the invoice from queue ?");
            if(confirmation){
               return true;
            }
            else{
                return false;
            }  
        }


    </script>

    <div id="discountPermissionModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="discountPermissionModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&#735;</button>
            <h3 id="itemEditModalLabel"><i class="icon-edit-sign"></i>&nbsp; Please Enter Password To Unlock Discount Field</h3>
        </div>
        <div class="modal-body" id="discountPermissionModalBody">
                <?php echo Form::open(array('route' => 'sale.discountPermission.post', 'id' => 'formDiscountPermissionModal', 'class' => 'form-horizontal')); ?>

                <div class="control-group">     
                    <?php echo Form::label('password', 'Password', ['class' => 'control-label']); ?>

                    <div class="controls">
                        <?php echo Form::password('password', null, array('class' => 'span3', 'placeholder' => 'Enter Password','autofocus'=>'yes')); ?>

                    </div> <!-- /controls -->                   
                </div> <!-- /control-group -->  
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                    <?php echo Form::submit('Save', array('class' => 'btn btn-primary')); ?>

                </div>
                <?php echo Form::close(); ?>

        </div>
    </div>

    <div id="addInvoiceToQueueModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="addInvoiceToQueueModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&#735;</button>
            <h3 id="itemEditModalLabel"><i class="icon-edit-sign"></i>&nbsp; Add Invoice To Queue</h3>
        </div>

        <div class="modal-body" id="addInvoiceToQueueModalBody">
                <?php echo Form::open(array('route' => 'sale.addInvoiceToQueue.post', 'id' => 'formAddInvoiceToQueue', 'class' => 'form-horizontal')); ?>

            
                <div class="control-group">     
                    <?php echo Form::label('Customer', 'Customer', ['class' => 'control-label']); ?>

                    <div class="controls">
                        <?php echo Form::text('customer', null, array('class' => 'span3', 'placeholder' => 'Enter Customer Name or Mobile','autofocus'=>'yes')); ?>


                    </div> <!-- /controls -->                   
                </div> <!-- /control-group -->  
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                    <?php echo Form::submit('Save', array('class' => 'btn btn-primary')); ?>

                </div>

                <?php echo Form::close(); ?>

        </div>
    </div>

    <script>
    $(function(){
        var formAddInvoiceToQueue = $('#formAddInvoiceToQueue');

        formAddInvoiceToQueue.validate({
          rules: {
           customer: {
               required: true
            }
          }, messages: {
            },
            ignore: ':hidden'   
        });
    });
$(window).load(function(){
        salesInit();
        $('#topTotalQuantity').html($('#toalQuantity').val());
    });
    function salesInit() {
        shortcut.add("Alt+c", function() {
            window.location = "<?php echo route('sale.emptyCart'); ?>";
        });
        shortcut.add("Alt+f", function() {
            $("#paynote").focus();
            //window.location = "<?php echo route('sale.emptyCart'); ?>";
        });

    }

</script>

<?php $__env->stopSection(); ?>

<?php $__env->startSection('stickyInfo'); ?>
<?php
    $string = 'Sales';
    $li = '';
    for($j=0;$j<strlen($string);$j++){
        $li .= '<li>'.substr($string,$j,1).'</li>';
    }
?>
<?php if(Session::has('redTheme')): ?>
<div id="sticky" style="text-align: center;">        
    <ul id="example-3" class="sticklr" style="margin-left:5px;color:#ffffff;background-color: #71253a;font-size:18px;font-family:monospace;">
        <?php echo $li; ?>

    </ul>       
</div>
<?php else: ?>
<div id="sticky" style="text-align: center;">        
    <ul id="example-3" class="sticklr" style="margin-left:5px;color:#ffffff;background-color: #053a64;font-size:18px;font-family:monospace;">
        <?php echo $li; ?>

    </ul>       
</div>
<?php endif; ?>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('_layouts.default', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>